<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Femud KazÄ± Kazan â€“ Premium</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="femud_logo.png" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #3d1a6b 0, #090017 55%, #02000a 100%);
      color: #fff;
      padding: 24px;
    }

    .card {
      width: 100%;
      max-width: 520px;
      background: rgba(20, 8, 40, 0.9);
      border-radius: 24px;
      padding: 24px 20px 28px;
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 20px 40px rgba(0,0,0,0.6);
    }

    .title {
      font-size: 22px;
      font-weight: 800;
      text-align: center;
      margin-bottom: 6px;
    }

    .subtitle {
      font-size: 14px;
      text-align: center;
      opacity: 0.9;
      line-height: 1.4;
      margin-bottom: 18px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(140, 91, 255, 0.25);
      border: 1px solid rgba(255,255,255,0.12);
      font-size: 12px;
      margin: 0 auto 18px;
    }

    .badge span { font-weight: 600; }

    label {
      font-size: 13px;
      opacity: 0.9;
      display: block;
      margin-bottom: 6px;
    }

    .input-group {
      margin-bottom: 14px;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.15);
      background: rgba(10, 3, 25, 0.9);
      color: #fff;
      font-size: 14px;
      outline: none;
    }

    input[type="text"]::placeholder {
      color: rgba(255,255,255,0.4);
    }

    .row {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }

    .btn {
      flex: 1;
      border-radius: 999px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      padding: 10px 14px;
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      white-space: nowrap;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ff4fb3, #ffb347);
      color: #1b062e;
      box-shadow: 0 8px 18px rgba(0,0,0,0.35);
    }

    .btn-secondary {
      background: rgba(255,255,255,0.06);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.12);
      margin-top: 6px;
      width: 100%;
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    .grid-wrapper {
      margin-top: 14px;
      border-radius: 20px;
      padding: 10px;
      background: radial-gradient(circle at top, #4b2b85 0, #180427 70%);
      border: 1px solid rgba(255,255,255,0.08);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 6px;
      margin-bottom: 8px;
    }

    .tile {
      position: relative;
      width: 100%;
      padding-top: 100%;
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      background: linear-gradient(135deg, #2a1147, #120521);
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: 0 6px 10px rgba(0,0,0,0.5);
    }

    .tile-inner {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 13px;
      letter-spacing: 0.5px;
    }

    .tile.scratched {
      background: #0b0015;
    }

    .tile.scratched .tile-inner {
      color: #ffdf6f;
    }

    .info-row {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      opacity: 0.9;
      margin-top: 4px;
    }

    .status {
      margin-top: 8px;
      font-size: 12px;
      min-height: 16px;
    }

    .status.ok { color: #6fff9b; }
    .status.err { color: #ff8080; }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }

    .modal {
      background: rgba(24, 6, 46, 0.96);
      padding: 20px 18px 18px;
      border-radius: 22px;
      width: 90%;
      max-width: 360px;
      border: 1px solid rgba(255,255,255,0.14);
      box-shadow: 0 20px 40px rgba(0,0,0,0.7);
      text-align: center;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 6px;
    }

    .modal-text {
      font-size: 13px;
      opacity: 0.9;
      line-height: 1.5;
      margin-bottom: 12px;
    }

    @media (min-width: 480px) {
      .card { padding: 26px 26px 30px; }
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="title">ðŸŽ« Femud KazÄ± Kazan â€“ Premium</div>
    <div class="subtitle">
      5x5 karttan en fazla <strong>6 tanesini</strong> kazÄ±.  
      AynÄ± tutardan <strong>3 adet</strong> bulursan Femud indirim kuponu senin! ðŸŽ‰
    </div>

    <div class="badge">
      <span>Hedef:</span> AynÄ± tutardan <strong>3 eÅŸleÅŸme</strong> yakala
    </div>

    <div class="input-group">
      <label for="ig">Instagram adÄ±n (@ iÅŸareti olmadan)</label>
      <input id="ig" type="text" placeholder="Ã¶r: femud_tr" />
    </div>

    <div class="grid-wrapper">
      <div class="grid" id="grid"></div>
      <div class="info-row">
        <span id="attemptInfo">Kalan hak: 0 / 6</span>
        <span id="foundInfo">BulduklarÄ±n: 50 â€¢ 40 â€¢ 30</span>
      </div>
    </div>

    <div class="status" id="status"></div>

    <button class="btn btn-secondary" id="btnBack">
      â¬… Ã‡arkÄ±felek'e DÃ¶n
    </button>
  </div>

  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
      <div class="modal-title" id="modalTitle">Tebrikler! ðŸŽ‰</div>
      <div class="modal-text" id="modalText"></div>
      <div class="row">
        <button class="btn btn-primary" id="btnPlayAgain">Tekrar Oyna</button>
      </div>
    </div>
  </div>

  <script>
    // ðŸ”— 1) Google Apps Script URL'in â€“ gerekirse burayÄ± kendi URLâ€™inle kontrol et
    const API_URL =
      'https://script.google.com/macros/s/AKfycbwxw3gTT1htqN3cuALPMdgSJm3213dIXG7TtJGChhMPLiIrLgg38TbuCTd_7GKobD1L/exec';

    const gridEl = document.getElementById('grid');
    const attemptInfo = document.getElementById('attemptInfo');
    const foundInfo = document.getElementById('foundInfo');
    const statusEl = document.getElementById('status');
    const igInput = document.getElementById('ig');

    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalTitle = document.getElementById('modalTitle');
    const modalText = document.getElementById('modalText');
    const btnPlayAgain = document.getElementById('btnPlayAgain');
    const btnBack = document.getElementById('btnBack');

    const rows = 5;
    const cols = 5;
    const maxClicks = 6;
    const values = ['50', '40', '30'];

    let cards = [];
    let clicked = 0;
    let counts = { '50': 0, '40': 0, '30': 0 };
    let gameFinished = false;

    function randomCardValues() {
      const arr = [];
      for (let i = 0; i < rows * cols; i++) {
        const v = values[Math.floor(Math.random() * values.length)];
        arr.push(v);
      }
      return arr;
    }

    function updateInfoText() {
      attemptInfo.textContent = `Kalan hak: ${Math.max(0, maxClicks - clicked)} / ${maxClicks}`;
      foundInfo.textContent =
        `BulduklarÄ±n: 50 TL: ${counts['50']} â€¢ 40 TL: ${counts['40']} â€¢ 30 TL: ${counts['30']}`;
    }

    function createGrid() {
      gridEl.innerHTML = '';
      cards = randomCardValues();
      clicked = 0;
      counts = { '50': 0, '40': 0, '30': 0 };
      gameFinished = false;
      statusEl.textContent = '';
      statusEl.className = 'status';

      cards.forEach((val, index) => {
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.dataset.index = index;
        tile.dataset.value = val;

        const inner = document.createElement('div');
        inner.className = 'tile-inner';
        inner.textContent = 'Femud';
        tile.appendChild(inner);

        tile.addEventListener('click', () => handleTileClick(tile));
        gridEl.appendChild(tile);
      });

      updateInfoText();
    }

    function handleTileClick(tile) {
      if (gameFinished) return;
      if (tile.classList.contains('scratched')) return;
      if (clicked >= maxClicks) return;

      const val = tile.dataset.value;
      clicked++;
      tile.classList.add('scratched');
      tile.querySelector('.tile-inner').textContent = `${val} TL`;

      counts[val] = (counts[val] || 0) + 1;
      updateInfoText();

      // KazandÄ± mÄ±?
      if (counts[val] >= 3) {
        gameFinished = true;
        showWin(val, counts[val]);
        saveWin(val, counts[val]);
        return;
      }

      // HakkÄ± bitti, kazanamadÄ±
      if (clicked >= maxClicks) {
        gameFinished = true;
        showLose();
      }
    }

    function showWin(amount, matchCount) {
      modalTitle.textContent = 'Tebrikler! ðŸŽ‰';
      modalText.textContent =
        `${amount} TL Femud indirim kuponu kazandÄ±n. ` +
        `Ekran gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼ @femud_tr hesabÄ±na gÃ¶ndererek kullanabilirsin.`;
      modalBackdrop.style.display = 'flex';
    }

    function showLose() {
      modalTitle.textContent = 'Maalesef! ðŸ˜”';
      modalText.textContent =
        'Bu turda 3 aynÄ± tutarÄ± yakalayamadÄ±n. Ä°stersen tekrar deneyebilirsin.';
      modalBackdrop.style.display = 'flex';
    }

    function saveWin(amount, matchCount) {
      const ig = igInput.value.trim();
      if (!ig) {
        statusEl.textContent = 'Instagram adÄ±nÄ± yazarsan kazancÄ±n tabloya kaydedilir.';
        statusEl.className = 'status err';
        return;
      }

      fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          type: 'scratch',               // ðŸ”¹ Apps Script bu tipe gÃ¶re KAZIKAZAN_KAZANANLAR sayfasÄ±na yazÄ±yor
          ig: ig || 'bos',
          amount: `${amount} TL Femud Kuponu`,
          matchCount: matchCount,
          ip: ''                         // Ä°stersen Apps Script tarafÄ±nda doldurursun
        })
      })
        .then(res => res.json().catch(() => null))
        .then(data => {
          statusEl.textContent = 'KazandÄ±ÄŸÄ±n kupon Google Sheetâ€™e kaydedildi. âœ…';
          statusEl.className = 'status ok';
        })
        .catch(err => {
          console.error(err);
          statusEl.textContent = 'Kupon kaydÄ± yapÄ±lamadÄ±, ama sen yine de kazandÄ±n. ðŸ˜‰';
          statusEl.className = 'status err';
        });
    }

    btnPlayAgain.addEventListener('click', () => {
      modalBackdrop.style.display = 'none';
      createGrid();
    });

    btnBack.addEventListener('click', () => {
      // Oyun merkezine / Ã§arkÄ±felek sayfasÄ±na dÃ¶n
      window.location.href = 'index.html';
    });

    // Sayfa aÃ§Ä±ldÄ±ÄŸÄ±nda oyunu baÅŸlat
    createGrid();
  </script>
</body>
</html>