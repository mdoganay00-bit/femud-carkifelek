<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Femud Kazƒ± Kazan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      background: radial-gradient(circle at top, #4b2d8f 0, #150323 45%, #05030a 100%);
      color: #fff;
    }

    .card {
      width: 100%;
      max-width: 520px;
      background: rgba(20, 6, 40, 0.94);
      border-radius: 28px;
      padding: 24px 22px 26px;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.65);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .title {
      font-size: 24px;
      font-weight: 800;
      text-align: center;
      margin-bottom: 6px;
      letter-spacing: 0.03em;
    }

    .subtitle {
      font-size: 14px;
      text-align: center;
      opacity: 0.85;
      margin-bottom: 18px;
      line-height: 1.4;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(140, 91, 255, 0.25);
      border: 1px solid rgba(255, 255, 255, 0.18);
      font-size: 12px;
      margin: 0 auto 18px;
    }

    .badge span {
      font-weight: 600;
    }

    label {
      font-size: 13px;
      opacity: 0.9;
      display: block;
      margin-bottom: 6px;
    }

    .input-group {
      margin-bottom: 12px;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.16);
      background: rgba(10, 3, 25, 0.9);
      color: #fff;
      font-size: 14px;
      outline: none;
    }

    input[type="text"]::placeholder {
      color: rgba(255, 255, 255, 0.45);
    }

    .grid-wrapper {
      margin-top: 12px;
      padding: 10px;
      border-radius: 22px;
      background: linear-gradient(135deg, #fbcf75, #f8a63a);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.55);
    }

    .grid-inner {
      background: radial-gradient(circle at top, #2d145d, #130727 60%, #070412 100%);
      border-radius: 18px;
      padding: 12px;
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
    }

    .card-cell {
      position: relative;
      height: 54px;
      border-radius: 14px;
      background: linear-gradient(145deg, #f4f4ff, #dad7ff);
      overflow: hidden;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.35);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.12s ease, box-shadow 0.12s ease, opacity 0.12s ease;
    }

    .card-cell.disabled {
      cursor: default;
      opacity: 0.6;
      box-shadow: none;
    }

    .card-cell-inner {
      width: 100%;
      height: 100%;
      border-radius: inherit;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: 700;
      color: #34126f;
      text-align: center;
      padding: 0 4px;
    }

    .card-cover {
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: linear-gradient(145deg, #5e3afc, #f94fbf);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }

    .card-cell.revealed .card-cover {
      opacity: 0;
      pointer-events: none;
    }

    .card-cell:active:not(.disabled) {
      transform: translateY(1px);
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.35);
    }

    .status-row {
      margin-top: 10px;
      font-size: 13px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .status-row strong {
      font-weight: 600;
    }

    .btn-row {
      margin-top: 16px;
      display: flex;
      gap: 8px;
    }

    .btn {
      flex: 1;
      border-radius: 999px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      padding: 10px 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      white-space: nowrap;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ff6fd6, #ffc46b);
      color: #1b062e;
      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.35);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.04);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.16);
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    .status {
      margin-top: 8px;
      font-size: 12px;
      min-height: 16px;
    }

    .status.ok {
      color: #6fff9b;
    }

    .status.err {
      color: #ff8080;
    }

    .small-note {
      margin-top: 10px;
      font-size: 11px;
      opacity: 0.7;
      line-height: 1.4;
      text-align: center;
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(5, 1, 16, 0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    .modal-backdrop.show {
      display: flex;
    }

    .modal {
      width: 100%;
      max-width: 420px;
      background: #1b082c;
      border-radius: 24px;
      padding: 22px 20px 20px;
      box-shadow: 0 24px 70px rgba(0, 0, 0, 0.85);
      border: 1px solid rgba(255, 255, 255, 0.12);
    }

    .modal-title {
      font-size: 20px;
      font-weight: 800;
      text-align: center;
      margin-bottom: 10px;
    }

    .modal-amount {
      color: #ffe177;
      font-size: 18px;
      font-weight: 800;
      text-align: center;
      margin-bottom: 6px;
    }

    .modal-text {
      font-size: 13px;
      line-height: 1.4;
      text-align: center;
      opacity: 0.9;
      margin-bottom: 12px;
    }

    .modal-buttons {
      display: flex;
      gap: 8px;
      margin-top: 6px;
    }

    @media (min-width: 480px) {
      .card {
        padding: 26px 24px 28px;
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="title">Femud Kazƒ± Kazan</div>
    <div class="subtitle">
      ƒ∞smini ve Instagram adresini yaz, 25 kutudan
      <strong>6 tanesini</strong> se√ß. Aynƒ± tutardan
      <strong>3 taneyi</strong> yakalarsan indirim kuponu senin!
    </div>

    <div class="badge">
      üéÅ <span>Her turda en fazla 6 kutu a√ßma hakkƒ±n var.</span>
    </div>

    <div class="input-group">
      <label for="name">Katƒ±lƒ±mcƒ± adƒ± (zorunlu)</label>
      <input id="name" type="text" placeholder="Adƒ±nƒ± yaz" />
    </div>

    <div class="input-group">
      <label for="ig">@ Instagram adresi (zorunlu)</label>
      <input id="ig" type="text" placeholder="@kullanici" />
    </div>

    <div class="grid-wrapper">
      <div class="grid-inner" id="cardGrid"></div>
    </div>

    <div class="status-row">
      <div>Kalan se√ßim hakkƒ±nƒ±z: <strong id="remaining">6</strong></div>
      <div id="foundInfo" style="font-size:12px;opacity:.8;"></div>
    </div>

    <div class="btn-row">
      <button class="btn btn-primary" id="btnStart">
        ‚ñ∂Ô∏è Oyuna Ba≈üla / Devam Et
      </button>
      <button class="btn btn-secondary" id="btnNewRound">
        üîÅ Yeni Tur
      </button>
    </div>

    <div class="status" id="status"></div>

    <div class="small-note">
      * Kupon tek seferliktir ve se√ßtiƒüin Femud √ºr√ºnleri i√ßin ge√ßerlidir.
      Sipari≈ü vermeden √∂nce ekran g√∂r√ºnt√ºs√º almayƒ± unutma.
    </div>
  </div>

  <!-- Sonu√ß Modali -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
      <div class="modal-title" id="modalTitle">TEBRƒ∞KLER! üéâ</div>
      <div class="modal-amount" id="modalAmount"></div>
      <div class="modal-text" id="modalText"></div>
      <div class="small-note" style="margin-top:4px;">
        Hediyeni talep etmek i√ßin ekran g√∂r√ºnt√ºs√ºn√º Instagram'da
        <strong>@Femud_tr</strong> hesabƒ±na DM olarak g√∂nder.
      </div>
      <div class="modal-buttons">
        <button class="btn btn-primary" id="btnPlayAgain">Tekrar Oyna</button>
        <button class="btn btn-secondary" id="btnCloseModal">Kapat</button>
      </div>
    </div>
  </div>

  <script>
    // üîó Google Apps Script adresin
    const SHEET_URL = "https://script.google.com/macros/s/AKfycbyplhi6pahLt8N68gKHnNbBn4cYJhbqLUlM81UHqHYLNzZEUsaSXLE0n5dc91-dc66z/exec";

    const gridEl = document.getElementById('cardGrid');
    const remainingEl = document.getElementById('remaining');
    const statusEl = document.getElementById('status');
    const foundInfoEl = document.getElementById('foundInfo');

    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalAmount = document.getElementById('modalAmount');
    const modalText = document.getElementById('modalText');
    const btnPlayAgain = document.getElementById('btnPlayAgain');
    const btnCloseModal = document.getElementById('btnCloseModal');

    const btnStart = document.getElementById('btnStart');
    const btnNewRound = document.getElementById('btnNewRound');

    const nameInput = document.getElementById('name');
    const igInput = document.getElementById('ig');

    const MAX_SELECT = 6;      // ‚úÖ 6 kutu hakkƒ±
    const REQUIRED_MATCH = 3;  // ‚úÖ 3 e≈üle≈üme

    // 25 kutuluk √∂d√ºl havuzu (5x5)
    const prizePool = [
      30, 30, 30, 30, 30,
      40, 40, 40, 40, 40,
      50, 50, 50, 50, 50,
      0, 0, 0, 0, 0,
      20, 20, 20, 10, 10
    ];

    let cards = [];
    let opened = [];
    let remaining = MAX_SELECT;
    let gameActive = false;

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function createGrid() {
      gridEl.innerHTML = '';
      const shuffled = shuffle([...prizePool]);

      cards = shuffled.map((amount, index) => {
        const cell = document.createElement('div');
        cell.className = 'card-cell';
        cell.dataset.index = index;

        const inner = document.createElement('div');
        inner.className = 'card-cell-inner';
        inner.textContent = amount === 0 ? 'Bo≈ü' : amount + ' TL';

        const cover = document.createElement('div');
        cover.className = 'card-cover';
        cover.textContent = 'Femud Kazƒ± Kazan';

        cell.appendChild(inner);
        cell.appendChild(cover);
        gridEl.appendChild(cell);

        cell.addEventListener('click', () => onCardClick(index));

        return { amount, cell, revealed: false };
      });

      opened = [];
      remaining = MAX_SELECT;
      remainingEl.textContent = remaining;
      foundInfoEl.textContent = '';
      statusEl.textContent = 'Kutular hazƒ±r. ƒ∞sim ve Instagram adresini doldurup oyuna ba≈ülayabilirsin.';
      statusEl.className = 'status ok';
      gameActive = true;
    }

    function onCardClick(index) {
      if (!gameActive) return;

      const card = cards[index];
      if (!card || card.revealed || remaining <= 0) return;

      card.revealed = true;
      card.cell.classList.add('revealed');

      opened.push(card.amount);
      remaining--;
      remainingEl.textContent = remaining;

      const counts = opened.reduce((acc, value) => {
        acc[value] = (acc[value] || 0) + 1;
        return acc;
      }, {});

      let bestAmount = 0;
      let bestCount = 0;
      Object.keys(counts).forEach(key => {
        const amount = parseInt(key, 10);
        const cnt = counts[key];
        if (amount > 0 && cnt > bestCount) {
          bestCount = cnt;
          bestAmount = amount;
        }
      });

      if (bestCount > 0) {
        foundInfoEl.textContent = bestAmount + ' TL: ' + bestCount + ' adet';
      }

      if (bestAmount > 0 && bestCount >= REQUIRED_MATCH) {
        finishGame(true, bestAmount, bestCount);
      } else if (remaining === 0) {
        finishGame(false, bestAmount, bestCount);
      }
    }

    function finishGame(isWin, amount, matchCount) {
      gameActive = false;
      cards.forEach(c => c.cell.classList.add('disabled'));

      if (isWin) {
        modalAmount.textContent = amount + ' TL Femud ƒ∞ndirim Kuponu Kazandƒ±nƒ±z';
        modalText.textContent =
          REQUIRED_MATCH + ' adet aynƒ± tutarƒ± yakaladƒ±nƒ±z. Bu indirimi 24 saat i√ßinde kullanabilirsiniz. ' +
          'Sipari≈ü vermeden √∂nce ekran g√∂r√ºnt√ºs√º almayƒ± unutmayƒ±n.';
        statusEl.textContent = 'Tebrikler, kupon kazandƒ±nƒ±z! Kaydƒ±nƒ±z Google Sheet\'e g√∂nderiliyor...';
        statusEl.className = 'status ok';

        // ‚úÖ Kazanƒ±yorsa sheet‚Äôe g√∂nder
        sendResultToSheet(amount, matchCount);
      } else {
        modalAmount.textContent = 'Bu turda kupon kazanamadƒ±nƒ±z.';
        modalText.textContent =
          '√úz√ºlme, kutular yeniden karƒ±≈üƒ±yor. Yeni turda tekrar deneyebilirsin!';
        statusEl.textContent = 'Bu turda kupon kazanƒ±lmadƒ±. ƒ∞stersen tekrar oynayabilirsin.';
        statusEl.className = 'status';
      }

      modalBackdrop.classList.add('show');
    }

    function resetGame() {
      createGrid();
    }

    function closeModal() {
      modalBackdrop.classList.remove('show');
    }

    // üî¥ Kazananƒ± Google Sheet'e g√∂nder
    async function sendResultToSheet(amount, matchCount) {
      const ig = (igInput.value || '').trim();
      if (!ig) {
        statusEl.textContent = 'Instagram adresin bo≈ü, yine de oyunu oynayabilirsin ama kayƒ±t yapƒ±lamadƒ±.';
        statusEl.className = 'status err';
        return;
      }

      // Kazƒ± Kazan oyunu KAZANINCA Sheet'e g√∂nder
const payload = {
  type: 'scratch',                     // ‚ö†Ô∏è Burasƒ± aynen b√∂yle kalacak
  ig: ig,                              // Instagram kullanƒ±cƒ± adƒ±
  amount: amount + ' TL Femud Kuponu', // Kazandƒ±ƒüƒ± tutar yazƒ±sƒ±
  matchCount: matchCount,              // Ka√ßƒ±ncƒ± e≈üle≈ümede kazandƒ±
  ip: ''                               // ƒ∞stersen sonra doldururuz
};

try {
  const res = await fetch(SHEET_URL, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(payload)
  });

  const data = await res.json().catch(() => null);

  if (!data || !data.ok) {
    console.error('Sheet kaydƒ± hatasƒ±:', data);
    statusEl.textContent =
      'Kupon kaydƒ± yapƒ±lamadƒ±, ekran g√∂r√ºnt√ºs√ºn√º sakla.';
    statusEl.className = 'status err';
  } else {
    statusEl.textContent =
      'Kazandƒ±ƒüƒ±n kupon Google Sheet‚Äôe kaydedildi.';
    statusEl.className = 'status ok';
  }
} catch (err) {
  console.error(err);
  statusEl.textContent =
    'Sunucuya baƒülanƒ±rken hata olu≈ütu, ekran g√∂r√ºnt√ºs√ºn√º sakla.';
  statusEl.className = 'status err';
}

      try {
        const res = await fetch(SHEET_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });

        await res.text().catch(() => null);
        statusEl.textContent = 'Kazandƒ±ƒüƒ±n kupon ba≈üarƒ±yla kaydedildi.';
        statusEl.className = 'status ok';
      } catch (err) {
        console.error(err);
        statusEl.textContent =
          'Kupon kaydƒ± sƒ±rasƒ±nda bir hata olu≈ütu. Yine de ekran g√∂r√ºnt√ºs√º ile bize yazabilirsin.';
        statusEl.className = 'status err';
      }
    }

    // üîò Butonlar
    btnStart.addEventListener('click', () => {
      const name = nameInput.value.trim();
      const ig = igInput.value.trim();

      if (!name || !ig) {
        statusEl.textContent = 'L√ºtfen √∂nce ismini ve Instagram adresini doldur.';
        statusEl.className = 'status err';
        return;
      }

      if (!gameActive) {
        createGrid();
      } else {
        statusEl.textContent = 'Oyun zaten aktif. Kutulardan se√ßim yapmaya devam edebilirsin.';
        statusEl.className = 'status ok';
      }
    });

    btnNewRound.addEventListener('click', () => {
      createGrid();
      statusEl.textContent = 'Kutular yeniden karƒ±≈ütƒ±rƒ±ldƒ±. Yeni tur ba≈üladƒ±.';
      statusEl.className = 'status ok';
    });

    btnPlayAgain.addEventListener('click', () => {
      closeModal();
      createGrid();
    });

    btnCloseModal.addEventListener('click', () => {
      closeModal();
    });

    // Sayfa a√ßƒ±lƒ±nca ilk turu hazƒ±rla
    createGrid();
  </script>
</body>
</html>