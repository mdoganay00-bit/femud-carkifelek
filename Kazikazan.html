<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Femud KazÄ± Kazan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Poppins", sans-serif;
      background: radial-gradient(circle at top, #f3e5f5 0, #b39ddb 35%, #4a148c 100%);
      color: #2d0055;
    }

    .container {
      width: 100%;
      max-width: 440px;
      background: rgba(255, 255, 255, 0.97);
      border-radius: 20px;
      padding: 18px 18px 22px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.45);
      text-align: center;
    }

    h1 {
      margin: 0 0 6px;
      font-size: 24px;
      font-weight: 800;
      color: #4a148c;
      text-shadow: 0 3px 6px rgba(155, 89, 182, 0.5);
    }

    .subtitle {
      font-size: 13px;
      color: #555;
      margin-bottom: 10px;
    }

    .field {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #d1c4e9;
      padding: 9px 14px;
      font-size: 13px;
      margin-bottom: 7px;
      outline: none;
    }

    .field:focus {
      border-color: #7e57c2;
      box-shadow: 0 0 0 2px rgba(126, 87, 194, 0.25);
    }

    .limit-note {
      font-size: 12px;
      color: #6a1b9a;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .grid-wrapper {
      margin: 0 auto 8px;
      padding: 10px;
      border-radius: 18px;
      background: radial-gradient(circle at top, #fff3e0 0, #ffe0b2 30%, #ffcc80 100%);
      box-shadow:
        0 0 0 3px rgba(255,255,255,0.9),
        0 10px 24px rgba(0,0,0,0.35),
        inset 0 0 12px rgba(255,255,255,0.8);
    }

    .grid-title {
      font-size: 13px;
      font-weight: 700;
      color: #bf360c;
      margin-bottom: 6px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 6px;
    }

    .card {
      position: relative;
      padding-top: 100%; /* kare */
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      background: linear-gradient(145deg, #7e57c2, #311b92);
      box-shadow:
        0 3px 6px rgba(0,0,0,0.35),
        inset 0 0 0 2px rgba(255,255,255,0.35);
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
    }

    .card-inner {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4px;
    }

    .card-logo {
      width: 80%;
      height: 80%;
      border-radius: 8px;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: inset 0 0 4px rgba(0,0,0,0.25);
      font-size: 11px;
      font-weight: 700;
      color: #4a148c;
    }

    .card-logo span {
      display: block;
      line-height: 1.1;
    }

    .card:hover {
      transform: translateY(-1px);
      box-shadow:
        0 6px 12px rgba(0,0,0,0.5),
        inset 0 0 0 2px rgba(255,255,255,0.65);
      filter: brightness(1.05);
    }

    .card.open {
      background: #fff;
      cursor: default;
      box-shadow:
        0 3px 8px rgba(0,0,0,0.35),
        inset 0 0 0 2px rgba(76,175,80,0.6);
    }

    .card-value {
      width: 100%;
      height: 100%;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      font-weight: 800;
      font-size: 14px;
      color: #1b5e20;
      background: radial-gradient(circle at top, #e8f5e9 0, #c8e6c9 40%, #a5d6a7 100%);
      text-shadow: 0 1px 2px rgba(255,255,255,0.9);
    }

    .card-value small {
      font-size: 11px;
      font-weight: 600;
      color: #33691e;
    }

    .card-empty {
      background: radial-gradient(circle at top, #eceff1 0, #cfd8dc 40%, #b0bec5 100%);
      color: #455a64;
    }

    .status {
      margin-top: 4px;
      font-size: 12px;
      color: #4a148c;
      font-weight: 600;
    }

    .btn-row {
      margin-top: 8px;
      display: flex;
      gap: 8px;
      justify-content: center;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 9px 18px;
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
      font-family: inherit;
    }

    .btn-play {
      flex: 1;
      max-width: 220px;
      background: linear-gradient(135deg, #7e57c2, #5e35b1);
      color: #fff;
      box-shadow: 0 8px 16px rgba(94,53,177,0.6);
    }

    .btn-play:active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(94,53,177,0.7);
    }

    .btn-play:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: 0 4px 10px rgba(94,53,177,0.4);
    }

    .btn-reset {
      background: #eceff1;
      color: #455a64;
      box-shadow: 0 3px 6px rgba(0,0,0,0.2);
    }

    .result-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }

    .result-box {
      background: #ffffff;
      border-radius: 16px;
      padding: 16px 16px 14px;
      width: 90%;
      max-width: 360px;
      box-shadow:
        0 12px 30px rgba(0,0,0,0.6),
        0 0 0 3px rgba(123,31,162,0.3);
      text-align: center;
    }

    .result-title {
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 6px;
      color: #4a148c;
    }

    .result-prize {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 4px;
      color: #1b5e20;
    }

    .result-text {
      font-size: 12px;
      color: #424242;
      line-height: 1.35;
      margin-bottom: 10px;
    }

    .note-ig {
      font-size: 12px;
      color: #6a1b9a;
      font-weight: 600;
    }

    .btn-close {
      margin-top: 6px;
      border-radius: 999px;
      padding: 8px 18px;
      border: none;
      background: linear-gradient(135deg, #7e57c2, #5e35b1);
      color: #fff;
      font-weight: 700;
      font-size: 13px;
      cursor: pointer;
    }

    .confetti {
      position: fixed;
      top: -10px;
      width: 8px;
      height: 14px;
      opacity: 0.9;
      pointer-events: none;
      z-index: 20;
      animation: confettiFall 3s linear forwards;
    }

    @keyframes confettiFall {
      0%   { transform: translate3d(0,0,0) rotateZ(0deg); }
      100% { transform: translate3d(var(--dx), 110vh, 0) rotateZ(720deg); }
    }

    @media (max-width: 480px) {
      .container {
        border-radius: 0;
        max-width: 100%;
        min-height: 100vh;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Femud KazÄ± Kazan</h1>
    <div class="subtitle">
      Ä°smini ve Instagram adresini yaz, 25 kutudan 6 tanesini seÃ§.
      AynÄ± tutardan <strong>3 taneyi</strong> yakalarsan o indirim senin!
    </div>

    <input id="nameInput" class="field" type="text" placeholder="KatÄ±lÄ±mcÄ± adÄ± (zorunlu)" />
    <input id="igInput" class="field" type="text" placeholder="Instagram adresi (@kullanici) (zorunlu)" />

    <div class="limit-note">
      Her turda en fazla <strong>6 kutu</strong> aÃ§ma hakkÄ±nÄ±z vardÄ±r.
    </div>

    <div class="grid-wrapper">
      <div class="grid-title">
        5 x 5 Femud Premium KazÄ± Kazan AlanÄ±
      </div>
      <div id="grid" class="grid"></div>
    </div>

    <div id="status" class="status">
      Kalan seÃ§im hakkÄ±nÄ±z: <strong>6</strong>
    </div>

    <div class="btn-row">
      <button id="btnPlay" class="btn btn-play">Oyuna BaÅŸla / Devam Et</button>
      <button id="btnReset" class="btn btn-reset">Yeni Tur</button>
    </div>
  </div>

  <!-- SonuÃ§ kutusu -->
  <div id="resultModal" class="result-modal">
    <div class="result-box">
      <div id="resultTitle" class="result-title"></div>
      <div id="resultPrize" class="result-prize"></div>
      <div id="resultText" class="result-text"></div>
      <div id="resultIg" class="note-ig"></div>
      <button id="btnCloseResult" class="btn-close">Tamam</button>
    </div>
  </div>

  <script>
    // ðŸ”— Google Apps Script URL (KazÄ± Kazan iÃ§in)
    // KazÄ±kazan 2 iÃ§in verdiÄŸin URL:
    const API_URL = "https://script.google.com/macros/s/AKfycbwxw3gTT1htqN3cuALPMdgSJm3213dIXG7TtJGChhMPLiIrLgg38TbuCTd_7GKobD1L/exec";

    const gridElement      = document.getElementById("grid");
    const statusElement    = document.getElementById("status");
    const nameInput        = document.getElementById("nameInput");
    const igInput          = document.getElementById("igInput");
    const btnPlay          = document.getElementById("btnPlay");
    const btnReset         = document.getElementById("btnReset");

    const modal            = document.getElementById("resultModal");
    const resultTitle      = document.getElementById("resultTitle");
    const resultPrize      = document.getElementById("resultPrize");
    const resultText       = document.getElementById("resultText");
    const resultIg         = document.getElementById("resultIg");
    const btnCloseResult   = document.getElementById("btnCloseResult");

    const MAX_SELECTIONS   = 6;

    let gridValues = [];   // 25 kutunun iÃ§indeki para deÄŸerleri
    let opened = [];       // true/false
    let selections = 0;
    let gameFinished = false;

    function createConfetti() {
      const colors = ["#ff5252", "#ffeb3b", "#69f0ae", "#40c4ff", "#ff80ab", "#b39ddb"];
      for (let i = 0; i < 90; i++) {
        const conf = document.createElement("div");
        conf.className = "confetti";
        const color = colors[Math.floor(Math.random() * colors.length)];
        conf.style.backgroundColor = color;
        const left = Math.random() * 100;
        const dx   = (Math.random() - 0.5) * 220 + "px";
        const delay = Math.random() * 0.35;
        conf.style.left = left + "vw";
        conf.style.setProperty("--dx", dx);
        conf.style.animationDelay = delay + "s";
        document.body.appendChild(conf);
        setTimeout(() => conf.remove(), 3500);
      }
    }

    // 25 deÄŸer Ã¼ret (50 / 40 / 30 TL kombinasyonu)
    function generateGridValues() {
      const values = [];
      // Ã–rnek daÄŸÄ±lÄ±m: 6 adet 50, 8 adet 40, 11 adet 30 = 25 kutu
      for (let i = 0; i < 6; i++)  values.push(50);
      for (let i = 0; i < 8; i++)  values.push(40);
      for (let i = 0; i < 11; i++) values.push(30);

      // Fisherâ€“Yates shuffle
      for (let i = values.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [values[i], values[j]] = [values[j], values[i]];
      }
      return values;
    }

    function setupGrid() {
      gridElement.innerHTML = "";
      gridValues = generateGridValues();
      opened = new Array(25).fill(false);
      selections = 0;
      gameFinished = false;
      updateStatus();

      for (let i = 0; i < 25; i++) {
        const card = document.createElement("div");
        card.className = "card";
        card.dataset.index = i;

        const inner = document.createElement("div");
        inner.className = "card-inner";

        const logoBox = document.createElement("div");
        logoBox.className = "card-logo";
        logoBox.innerHTML = "<span>Femud<br/>KazÄ± Kazan</span>";

        inner.appendChild(logoBox);
        card.appendChild(inner);

        card.addEventListener("click", onCardClick);
        gridElement.appendChild(card);
      }
    }

    function updateStatus() {
      const remaining = MAX_SELECTIONS - selections;
      statusElement.innerHTML = `Kalan seÃ§im hakkÄ±nÄ±z: <strong>${remaining}</strong>`;
    }

    function onCardClick(e) {
      if (gameFinished) return;

      const card = e.currentTarget;
      const index = Number(card.dataset.index);

      if (opened[index]) return;           // aynÄ± kutuya tekrar tÄ±klama
      if (selections >= MAX_SELECTIONS) {  // 6 seÃ§im doldu
        return;
      }

      opened[index] = true;
      selections++;
      updateStatus();
      revealCard(card, gridValues[index]);

      if (selections === MAX_SELECTIONS) {
        finishGame();
      }
    }

    function revealCard(card, value) {
      card.classList.add("open");
      const inner = card.querySelector(".card-inner");
      inner.innerHTML = "";

      const valueBox = document.createElement("div");
      valueBox.className = "card-value";

      if (value === 0) {
        valueBox.classList.add("card-empty");
        valueBox.textContent = "BoÅŸ";
      } else {
        valueBox.innerHTML = `
          <div>${value} TL</div>
          <small>Ä°ndirim ÅžansÄ±</small>
        `;
      }

      inner.appendChild(valueBox);
    }

    function finishGame() {
      gameFinished = true;

      // AÃ§Ä±lan kutularda kaÃ§ tane 50 / 40 / 30 var
      let count50 = 0, count40 = 0, count30 = 0;

      opened.forEach((isOpen, idx) => {
        if (!isOpen) return;
        const val = gridValues[idx];
        if (val === 50) count50++;
        else if (val === 40) count40++;
        else if (val === 30) count30++;
      });

      let wonAmount = 0;
      if (count50 >= 3)      wonAmount = 50;
      else if (count40 >= 3) wonAmount = 40;
      else if (count30 >= 3) wonAmount = 30;

      showResult(wonAmount);
    }

    function showResult(wonAmount) {
      const nameRaw = nameInput.value.trim();
      let igRaw     = igInput.value.trim();

      if (!nameRaw || !igRaw) {
        // KullanÄ±cÄ± isim/IG girmediyse bile en azÄ±ndan ekranda uyarÄ± verelim
        // ama kazÄ± sonucunu da gÃ¶rebilsin.
        // Sheet'e boÅŸ gÃ¶nderilebilir.
      }

      if (igRaw && !igRaw.startsWith("@")) {
        igRaw = "@" + igRaw;
      }
      const igClean = igRaw.replace(/^@/, "").trim();

      if (wonAmount > 0) {
        resultTitle.textContent = "TEBRÄ°KLER! ðŸŽ‰";
        resultPrize.textContent = `${wonAmount} TL Femud Ä°ndirim Kuponu KazandÄ±nÄ±z`;
        resultText.innerHTML =
          "3 adet aynÄ± tutarÄ± yakaladÄ±nÄ±z. Bu indirim tutarÄ±nÄ± 24 saat iÃ§inde kullanma hakkÄ±nÄ±z var.<br>" +
          "SipariÅŸ vermeden Ã¶nce lÃ¼tfen ekran gÃ¶rÃ¼ntÃ¼sÃ¼ almayÄ± unutmayÄ±n.";
        resultIg.innerHTML =
          "Hediyenizi talep etmek iÃ§in ekran gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼ Instagram'da " +
          "<strong>@Femud_tr</strong> hesabÄ±na DM olarak gÃ¶nderiniz." +
          (igClean ? `<br>Kaydedilen Instagram: <strong>@${igClean}</strong>` : "");
        createConfetti();
      } else {
        resultTitle.textContent = "Bu Turda BÃ¼yÃ¼k Ã–dÃ¼l Yok ðŸ˜‡";
        resultPrize.textContent = "";
        resultText.innerHTML =
          "6 kutu iÃ§erisinden 3 aynÄ± tutarÄ± yakalayamadÄ±nÄ±z.<br>" +
          "Dilerseniz yeni turda tekrar ÅŸansÄ±nÄ±zÄ± deneyebilirsiniz.";
        resultIg.textContent = "";
      }

      // Sheet'e kayÄ±t gÃ¶nder
      sendToSheet(nameRaw, igClean, wonAmount);

      modal.style.display = "flex";
    }

    btnCloseResult.addEventListener("click", () => {
      modal.style.display = "none";
    });

    btnReset.addEventListener("click", () => {
      modal.style.display = "none";
      setupGrid();
    });

    btnPlay.addEventListener("click", () => {
      // Ekstra bir iÅŸlem yapmÄ±yor; grid zaten aktif.
      // Ä°stersen buraya 24 saat / gÃ¼nlÃ¼k limit kontrolÃ¼ eklenebilir (JS tarafÄ±).
    });

    function sendToSheet(name, ig, wonAmount) {
      try {
        const prizeText = wonAmount > 0
          ? `${wonAmount} TL KazÄ± Kazan Ã¶dÃ¼lÃ¼`
          : `KazÄ± Kazan - Ã¶dÃ¼l yok`;

        const payload = {
          name:  name || "",
          ig:    ig   || "",
          prize: prizeText,
          game:  "KazÄ±Kazan",
          points: wonAmount || 0
        };

        fetch(API_URL, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        }).catch(err => {
          console.log("KazÄ± Kazan kaydÄ± gÃ¶nderilirken hata:", err);
        });
      } catch (err) {
        console.log("KazÄ± Kazan kaydÄ± gÃ¶nderilemedi:", err);
      }
    }

    // Sayfa aÃ§Ä±lÄ±r aÃ§Ä±lmaz Ä±zgarayÄ± kur
    setupGrid();
  </script>
</body>
</html>