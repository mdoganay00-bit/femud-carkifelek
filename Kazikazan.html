<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Femud KazÄ± Kazan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Poppins", sans-serif;
      background: radial-gradient(circle at top, #f3e5f5 0, #b39ddb 35%, #4a148c 100%);
      color: #2d0055;
    }

    .container {
      width: 100%;
      max-width: 430px;
      background: rgba(255, 255, 255, 0.98);
      border-radius: 18px;
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.45);
      padding: 18px 18px 22px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .tag {
      position: absolute;
      top: 10px;
      left: 14px;
      background: linear-gradient(135deg, #ffd700, #ffb300);
      color: #4a148c;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 700;
      box-shadow: 0 4px 10px rgba(0,0,0,0.25);
    }

    h1 {
      margin: 4px 0 4px;
      font-size: 22px;
      font-weight: 800;
      color: #4a148c;
      text-shadow: 0 3px 6px rgba(155, 89, 182, 0.5);
    }

    .subtitle {
      font-size: 13px;
      color: #555;
      margin-bottom: 10px;
    }

    .field {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #d1c4e9;
      padding: 9px 14px;
      font-size: 14px;
      margin-bottom: 8px;
      outline: none;
    }

    .field:focus {
      border-color: #7e57c2;
      box-shadow: 0 0 0 2px rgba(126, 87, 194, 0.25);
    }

    .status-bar {
      font-size: 12px;
      font-weight: 600;
      color: #6a1b9a;
      margin: 4px 0 10px;
    }

    .grid-wrapper {
      margin: 0 auto 10px;
      padding: 10px;
      border-radius: 18px;
      background: radial-gradient(circle, #fff8e1 0, #ffe082 30%, #ffca28 70%, #ffb300 100%);
      box-shadow:
        0 6px 15px rgba(0, 0, 0, 0.35),
        inset 0 3px 5px rgba(255, 255, 255, 0.8);
      position: relative;
    }

    .grid-title {
      font-size: 13px;
      font-weight: 700;
      color: #4a148c;
      margin-bottom: 6px;
      text-shadow: 0 1px 1px rgba(255,255,255,0.6);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 6px;
    }

    .cell {
      width: 56px;
      height: 56px;
      border-radius: 10px;
      background: linear-gradient(145deg, #7e57c2, #5e35b1);
      box-shadow:
        0 4px 8px rgba(0, 0, 0, 0.3),
        inset 0 2px 4px rgba(255,255,255,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      color: #fff;
      font-weight: 700;
      font-size: 13px;
      text-align: center;
      transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
      user-select: none;
    }

    .cell::before {
      content: "F";
      position: absolute;
      font-size: 28px;
      font-weight: 800;
      color: rgba(255,255,255,0.18);
    }

    .cell:hover {
      transform: translateY(-2px);
      box-shadow:
        0 6px 10px rgba(0, 0, 0, 0.35),
        inset 0 2px 4px rgba(255,255,255,0.6);
    }

    .cell.revealed {
      background: #ffffff;
      color: #4a148c;
      box-shadow:
        0 3px 7px rgba(0, 0, 0, 0.3),
        inset 0 0 0 2px rgba(94,53,177,0.6);
    }

    .cell.revealed::before {
      content: "";
    }

    .cell.prize-50 {
      background: #ffeb3b;
      color: #4a148c;
    }

    .cell.prize-40 {
      background: #ffca28;
      color: #4a148c;
    }

    .cell.prize-30 {
      background: #ffe082;
      color: #4a148c;
    }

    .cell.empty {
      background: #f5f5f5;
      color: #9e9e9e;
    }

    .cell.disabled {
      cursor: default;
      opacity: 0.9;
    }

    .btn-primary {
      width: 100%;
      margin-top: 4px;
      padding: 11px 20px;
      border-radius: 999px;
      border: none;
      font-size: 16px;
      font-weight: 700;
      color: #fff;
      cursor: pointer;
      background: linear-gradient(135deg, #7e57c2, #5e35b1);
      box-shadow: 0 10px 20px rgba(94, 53, 177, 0.6);
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 4px 10px rgba(94, 53, 177, 0.7);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: 0 4px 10px rgba(94, 53, 177, 0.4);
    }

    .info {
      margin-top: 8px;
      font-size: 11px;
      color: #666;
      line-height: 1.3;
    }

    /* SonuÃ§ penceresi (modal) */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }

    .overlay.visible {
      display: flex;
    }

    .overlay-box {
      background: #ffffff;
      border-radius: 16px;
      padding: 16px 18px 14px;
      max-width: 360px;
      width: 90%;
      text-align: center;
      box-shadow: 0 14px 40px rgba(0,0,0,0.4);
      position: relative;
      overflow: hidden;
    }

    .overlay-badge {
      position: absolute;
      top: -12px;
      right: -40px;
      background: linear-gradient(135deg, #ff9800, #ff5722);
      color: #fff;
      font-size: 11px;
      font-weight: 700;
      padding: 4px 40px;
      transform: rotate(20deg);
      box-shadow: 0 6px 10px rgba(0,0,0,0.35);
    }

    .overlay-title {
      font-size: 18px;
      font-weight: 800;
      color: #4a148c;
      margin-bottom: 6px;
    }

    .overlay-prize {
      font-size: 16px;
      font-weight: 700;
      color: #311b92;
      margin-bottom: 6px;
    }

    .overlay-text {
      font-size: 13px;
      color: #444;
      line-height: 1.4;
      margin-bottom: 10px;
    }

    .overlay-btn {
      margin-top: 4px;
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      color: #fff;
      background: linear-gradient(135deg, #7e57c2, #5e35b1);
      cursor: pointer;
      box-shadow: 0 6px 14px rgba(94,53,177,0.6);
    }

    .overlay-btn:active {
      transform: translateY(1px);
      box-shadow: 0 3px 8px rgba(94,53,177,0.7);
    }

    /* Konfeti parÃ§acÄ±klarÄ± */
    .confetti {
      position: fixed;
      top: -10px;
      width: 8px;
      height: 14px;
      opacity: 0.9;
      pointer-events: none;
      z-index: 30;
      animation: confettiFall 3s linear forwards;
    }

    @keyframes confettiFall {
      0% {
        transform: translate3d(0, 0, 0) rotateZ(0deg);
      }
      100% {
        transform: translate3d(var(--dx), 110vh, 0) rotateZ(720deg);
      }
    }

    @media (max-width: 480px) {
      .container {
        border-radius: 0;
        max-width: 100%;
        min-height: 100vh;
      }
      .grid-wrapper {
        margin-top: 6px;
      }
      .cell {
        width: 52px;
        height: 52px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="tag">Femud Premium KazÄ± Kazan</div>

    <h1>Femud KazÄ± Kazan</h1>
    <div class="subtitle">
      5x5 alandan <strong>6 kutu</strong> seÃ§. AynÄ± tutardan <strong>3 tane</strong> bulursan, o indirim kuponunu kazan!
    </div>

    <input id="nameInput" class="field" type="text" placeholder="Ad Soyad (zorunlu)" />
    <input id="igInput" class="field" type="text" placeholder="Instagram adresi (@kullanici) (zorunlu)" />

    <div id="status" class="status-bar">
      Oyuna baÅŸlamak iÃ§in bilgileri doldurup "Oyunu BaÅŸlat" butonuna basÄ±n.
    </div>

    <div class="grid-wrapper">
      <div class="grid-title">Her kutuda gizli bir Femud ÅŸansÄ± var ðŸŒŸ</div>
      <div id="grid" class="grid"></div>
    </div>

    <button id="startBtn" class="btn-primary">Oyunu BaÅŸlat</button>

    <div class="info">
      â€¢ Her turda sadece 6 kutu aÃ§ma hakkÄ±nÄ±z var.<br />
      â€¢ AynÄ± deÄŸerden 3 kutu bulursanÄ±z o indirimi kazanÄ±rsÄ±nÄ±z.<br />
      â€¢ Ekran gÃ¶rÃ¼ntÃ¼sÃ¼ almayÄ± unutmayÄ±n ve @Femud_tr hesabÄ±na DM gÃ¶nderin.
    </div>
  </div>

  <!-- SonuÃ§ penceresi -->
  <div id="overlay" class="overlay">
    <div class="overlay-box">
      <div class="overlay-badge">Femud Oyun Merkezi</div>
      <div id="overlayTitle" class="overlay-title"></div>
      <div id="overlayPrize" class="overlay-prize"></div>
      <div id="overlayText" class="overlay-text"></div>
      <button id="overlayBtn" class="overlay-btn">Tamam</button>
    </div>
  </div>

  <script>
    // ðŸ”— Google Apps Script URL'in (cÃ¼zdanlÄ± sÃ¼rÃ¼m)
    const API_URL = "https://script.google.com/macros/s/AKfycbyplhi6pahLt8N68gKHnNbBn4cYJhbqLUlM81UHqHYLNzZEUsaSXLE0n5dc91-dc66z/exec";

    const GRID_SIZE = 25;  // 5x5
    const MAX_CLICKS = 6;

    // Ã–dÃ¼l tanÄ±mlarÄ±
    const PRIZES = {
      "50TL": { label: "50 TL Femud Ä°ndirim Kuponu", amount: 50, className: "prize-50" },
      "40TL": { label: "40 TL Femud Ä°ndirim Kuponu", amount: 40, className: "prize-40" },
      "30TL": { label: "30 TL Femud Ä°ndirim Kuponu", amount: 30, className: "prize-30" },
      "BOS":  { label: "BoÅŸ Kutucuk", amount: 0,   className: "empty" }
    };

    // Izgara iÃ§eriÄŸi (dizilim)
    // Ä°stersen bu daÄŸÄ±lÄ±mÄ± deÄŸiÅŸtirip olasÄ±lÄ±kla oynayabilirsin
    const prizePoolTemplate = [
      "50TL","50TL","50TL","50TL",
      "40TL","40TL","40TL","40TL",
      "30TL","30TL","30TL","30TL",
      "BOS","BOS","BOS","BOS","BOS","BOS","BOS","BOS","BOS","BOS","BOS"
    ];
    // Toplam 4 + 4 + 4 + 13 = 25

    const gridEl = document.getElementById("grid");
    const startBtn = document.getElementById("startBtn");
    const statusEl = document.getElementById("status");
    const nameInput = document.getElementById("nameInput");
    const igInput = document.getElementById("igInput");

    const overlayEl = document.getElementById("overlay");
    const overlayTitleEl = document.getElementById("overlayTitle");
    const overlayPrizeEl = document.getElementById("overlayPrize");
    const overlayTextEl = document.getElementById("overlayText");
    const overlayBtn = document.getElementById("overlayBtn");

    let currentGrid = [];        // 25 elemanlÄ± (her biri 50TL/40TL/30TL/BOS)
    let clickCount = 0;
    let isPlaying = false;
    let chosenPrizes = {};       // { "50TL": kaÃ§ defa seÃ§ildi, ... }

    // Basit karÄ±ÅŸtÄ±rma fonksiyonu
    function shuffle(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function resetGame() {
      // Yeni 5x5 dizilimi oluÅŸtur
      currentGrid = shuffle(prizePoolTemplate);
      clickCount = 0;
      isPlaying = true;
      chosenPrizes = {};
      statusEl.textContent = "Åžu anda tur baÅŸladÄ±: 6 kutu seÃ§me hakkÄ±nÄ±z var.";
      startBtn.disabled = true;

      // IzgarayÄ± temizle ve yeniden oluÅŸtur
      gridEl.innerHTML = "";
      for (let i = 0; i < GRID_SIZE; i++) {
        const cell = document.createElement("div");
        cell.className = "cell";
        cell.dataset.index = i.toString();
        cell.addEventListener("click", onCellClick);
        gridEl.appendChild(cell);
      }
    }

    function onCellClick(e) {
      if (!isPlaying) return;

      const cell = e.currentTarget;
      const index = Number(cell.dataset.index);

      // AynÄ± hÃ¼creye ikinci kez tÄ±klanmasÄ±n
      if (cell.classList.contains("revealed")) return;
      if (clickCount >= MAX_CLICKS) return;

      const prizeKey = currentGrid[index];
      const prizeDef = PRIZES[prizeKey];

      // HÃ¼creyi aÃ§
      cell.classList.add("revealed", "disabled");
      if (prizeKey !== "BOS") {
        cell.classList.add(prizeDef.className);
        cell.textContent = prizeDef.label.split(" ")[0] + " " + prizeDef.label.split(" ")[1]; // "50 TL" gibi
      } else {
        cell.classList.add(prizeDef.className);
        cell.textContent = "BoÅŸ";
      }

      // SayaÃ§larÄ± gÃ¼ncelle
      clickCount++;
      statusEl.textContent = `SeÃ§ilen kutu sayÄ±sÄ±: ${clickCount} / ${MAX_CLICKS}`;

      if (!chosenPrizes[prizeKey]) {
        chosenPrizes[prizeKey] = 0;
      }
      chosenPrizes[prizeKey]++;

      // KazanÃ§ kontrolÃ¼ (BOS hariÃ§)
      if (prizeKey !== "BOS" && chosenPrizes[prizeKey] >= 3) {
        // KazandÄ±
        endGameWithWin(prizeKey);
        return;
      }

      // 6 hak bitti ama bÃ¼yÃ¼k Ã¶dÃ¼l yok
      if (clickCount >= MAX_CLICKS) {
        endGameNoWin();
      }
    }

    function endGameWithWin(prizeKey) {
      isPlaying = false;

      const prizeDef = PRIZES[prizeKey];
      const name = nameInput.value.trim();
      let ig = igInput.value.trim();

      if (!ig.startsWith("@")) {
        ig = "@" + ig;
      }
      const igClean = ig.replace(/^@/, "").trim();

      // Ekran durumu
      statusEl.textContent = "Tebrikler! BÃ¼yÃ¼k Ã¶dÃ¼lÃ¼ yakaladÄ±nÄ±z.";
      startBtn.disabled = false;
      startBtn.textContent = "Yeni Tur BaÅŸlat";

      // Konfeti
      launchConfetti();

      // SonuÃ§ penceresi
      overlayTitleEl.textContent = "TEBRÄ°KLER! ðŸŽ‰";
      overlayPrizeEl.textContent = prizeDef.label;
      overlayTextEl.innerHTML = `
        SeÃ§tiÄŸiniz kutulardan <strong>3 adet aynÄ± tutarÄ±</strong> buldunuz.<br><br>
        LÃ¼tfen bu ekranÄ±n <strong>ekran gÃ¶rÃ¼ntÃ¼sÃ¼nÃ¼</strong> alÄ±n ve
        Instagram'da <strong>@Femud_tr</strong> hesabÄ±na DM olarak gÃ¶nderin.<br><br>
        Mesajda <strong>adÄ±nÄ±z</strong> ve <strong>Instagram hesabÄ±nÄ±z</strong> ile
        bu <strong>indirim kuponunu 24 saat iÃ§inde</strong> kullanmak istediÄŸinizi belirtin.
      `;
      overlayEl.classList.add("visible");

      // Google Sheets'e kayÄ±t gÃ¶nder
      sendResultToSheet({
        name: name,
        ig: igClean,
        prize: prizeDef.label,
        game: "KazÄ± Kazan",
        points: prizeDef.amount
      });
    }

    function endGameNoWin() {
      isPlaying = false;
      statusEl.textContent = "Bu turda bÃ¼yÃ¼k Ã¶dÃ¼l Ã§Ä±kmadÄ±. YarÄ±n tekrar ÅŸansÄ±nÄ±zÄ± deneyebilirsiniz.";
      startBtn.disabled = false;
      startBtn.textContent = "Yeni Tur BaÅŸlat";

      overlayTitleEl.textContent = "Bu Turda BÃ¼yÃ¼k Ã–dÃ¼l Yok ðŸ˜Œ";
      overlayPrizeEl.textContent = "KazÄ± Kazan Sonucu";
      overlayTextEl.innerHTML = `
        AÃ§tÄ±ÄŸÄ±nÄ±z 6 kutuda aynÄ± tutardan <strong>3 adet</strong> denk gelmedi.<br><br>
        Merak etmeyin, Femud oyunlarÄ± her zaman geri gelir!<br>
        Daha sonra tekrar deneyerek Femud TL kazanmayÄ± sÃ¼rdÃ¼rebilirsiniz.
      `;
      overlayEl.classList.add("visible");

      // KayÄ±t gÃ¶nder (puan 0)
      const name = nameInput.value.trim();
      let ig = igInput.value.trim();
      if (!ig.startsWith("@")) {
        ig = "@" + ig;
      }
      const igClean = ig.replace(/^@/, "").trim();

      sendResultToSheet({
        name: name,
        ig: igClean,
        prize: "Kazanan Ã§Ä±kmadÄ±",
        game: "KazÄ± Kazan",
        points: 0
      });
    }

    // SonuÃ§ penceresi kapa
    overlayBtn.addEventListener("click", () => {
      overlayEl.classList.remove("visible");
    });

    // Konfeti efekti
    function launchConfetti() {
      const colors = ["#ff5252", "#ffeb3b", "#69f0ae", "#40c4ff", "#ff80ab", "#b39ddb"];

      for (let i = 0; i < 100; i++) {
        const conf = document.createElement("div");
        conf.className = "confetti";

        const color = colors[Math.floor(Math.random() * colors.length)];
        conf.style.backgroundColor = color;

        const left = Math.random() * 100;
        const dx = (Math.random() - 0.5) * 200 + "px";
        const delay = Math.random() * 0.4;

        conf.style.left = left + "vw";
        conf.style.setProperty("--dx", dx);
        conf.style.animationDelay = delay + "s";

        document.body.appendChild(conf);

        setTimeout(() => conf.remove(), 3500);
      }
    }

    // Sonucu Google Sheet'e gÃ¶nder
    function sendResultToSheet(payload) {
      // Apps Script tarafÄ±nda game + points alanlarÄ±nÄ± kullanacaÄŸÄ±z.
      try {
        fetch(API_URL, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            name: payload.name,
            ig: payload.ig,
            prize: payload.prize,
            game: payload.game,   // "KazÄ± Kazan"
            points: payload.points
          })
        }).catch(err => {
          console.log("KayÄ±t gÃ¶nderilirken hata:", err);
        });
      } catch (err) {
        console.log("KayÄ±t gÃ¶nderilemedi:", err);
      }
    }

    // Oyunu baÅŸlat butonu
    startBtn.addEventListener("click", () => {
      const name = nameInput.value.trim();
      let ig = igInput.value.trim();

      if (!name || !ig) {
        alert("LÃ¼tfen Ã¶nce adÄ±nÄ±zÄ± ve Instagram adresinizi doldurun.");
        return;
      }
      if (!ig.startsWith("@")) {
        ig = "@" + ig;
        igInput.value = ig;
      }

      resetGame();
    });

    // Sayfa ilk aÃ§Ä±ldÄ±ÄŸÄ±nda boÅŸ 5x5 grid (tÄ±klanamaz)
    (function initEmptyGrid() {
      gridEl.innerHTML = "";
      for (let i = 0; i < GRID_SIZE; i++) {
        const cell = document.createElement("div");
        cell.className = "cell disabled";
        cell.textContent = "";
        gridEl.appendChild(cell);
      }
    })();
  </script>
</body>
</html>