<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Femud Kazƒ± Kazan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Poppins", sans-serif;
      background: radial-gradient(circle at top, #f3e5f5 0, #b39ddb 35%, #4a148c 100%);
      color: #2d0055;
    }

    .container {
      width: 100%;
      max-width: 420px;
      background: rgba(255, 255, 255, 0.97);
      border-radius: 18px;
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.45);
      padding: 18px 18px 22px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    h1 {
      margin: 0 0 4px;
      font-size: 24px;
      font-weight: 800;
      color: #4a148c;
      text-shadow: 0 3px 6px rgba(155, 89, 182, 0.5);
    }

    .subtitle {
      font-size: 13px;
      color: #555;
      margin-bottom: 10px;
    }

    .field {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #d1c4e9;
      padding: 10px 14px;
      font-size: 14px;
      margin-bottom: 8px;
      outline: none;
    }

    .field:focus {
      border-color: #7e57c2;
      box-shadow: 0 0 0 2px rgba(126, 87, 194, 0.25);
    }

    .wallet-box {
      margin: 6px 0 12px;
      padding: 8px 10px;
      border-radius: 999px;
      background: #ede7f6;
      font-size: 13px;
      font-weight: 600;
      color: #4a148c;
    }

    .wallet-box span {
      font-weight: 800;
    }

    .card-wrapper {
      margin: 0 auto 10px;
      width: 100%;
      max-width: 360px;
      height: 190px;
      position: relative;
      perspective: 900px;
    }

    .card-glow {
      position: absolute;
      inset: -10px;
      border-radius: 24px;
      background: radial-gradient(circle, rgba(156,39,176,0.6) 0, rgba(81,45,168,0.3) 40%, transparent 70%);
      filter: blur(6px);
      z-index: 0;
    }

    .scratch-card {
      position: relative;
      width: 100%;
      height: 100%;
      border-radius: 22px;
      background: linear-gradient(135deg, #7e57c2, #311b92);
      box-shadow:
        0 15px 30px rgba(0, 0, 0, 0.45),
        inset 0 3px 6px rgba(255, 255, 255, 0.45);
      overflow: hidden;
      color: #fff;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .scratch-header {
      font-size: 15px;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin-bottom: 6px;
    }

    .scratch-sub {
      font-size: 12px;
      opacity: 0.9;
      margin-bottom: 10px;
    }

    .scratch-inner {
      width: 80%;
      max-width: 260px;
      min-height: 70px;
      border-radius: 16px;
      background: #f5f5f5;
      color: #4a148c;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
      position: relative;
      overflow: hidden;
      box-shadow:
        0 4px 10px rgba(0,0,0,0.35),
        inset 0 2px 4px rgba(255,255,255,0.9);
    }

    .scratch-result-text {
      z-index: 2;
      font-weight: 700;
      font-size: 15px;
      text-align: center;
      line-height: 1.25;
    }

    .scratch-cover {
      position: absolute;
      inset: 0;
      background: repeating-linear-gradient(
        -45deg,
        #b0bec5,
        #b0bec5 6px,
        #cfd8dc 6px,
        #cfd8dc 12px
      );
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #263238;
      font-weight: 700;
      font-size: 13px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      z-index: 3;
      box-shadow:
        inset 0 3px 5px rgba(255,255,255,0.7),
        inset 0 -3px 5px rgba(0,0,0,0.25);
    }

    .scratch-cover.hidden {
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease-out;
    }

    .btn-play {
      width: 100%;
      margin-top: 8px;
      padding: 12px 20px;
      border-radius: 999px;
      border: none;
      font-size: 16px;
      font-weight: 700;
      color: #fff;
      cursor: pointer;
      background: linear-gradient(135deg, #ff6f69, #ff1744);
      box-shadow: 0 10px 20px rgba(255, 23, 68, 0.5);
    }

    .btn-play:active {
      transform: translateY(1px);
      box-shadow: 0 4px 12px rgba(255, 23, 68, 0.7);
    }

    .btn-play:disabled {
      opacity: 0.65;
      cursor: not-allowed;
      box-shadow: 0 5px 12px rgba(94, 53, 177, 0.4);
    }

    #result {
      margin-top: 10px;
      min-height: 40px;
      font-size: 14px;
      font-weight: 600;
      color: #4a148c;
    }

    #result .note {
      font-size: 12px;
      font-weight: 500;
      color: #555;
      margin-top: 4px;
    }

    /* Konfeti */
    .confetti {
      position: fixed;
      top: -10px;
      width: 8px;
      height: 14px;
      opacity: 0.9;
      pointer-events: none;
      z-index: 20;
      animation: confettiFall 3s linear forwards;
    }

    @keyframes confettiFall {
      0% {
        transform: translate3d(0, 0, 0) rotateZ(0deg);
      }
      100% {
        transform: translate3d(var(--dx), 110vh, 0) rotateZ(720deg);
      }
    }

    /* 30 TL b√ºy√ºk √∂d√ºl bildirimi */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 30;
    }

    .modal-backdrop.show {
      display: flex;
    }

    .modal-box {
      width: 90%;
      max-width: 360px;
      background: #ffffff;
      border-radius: 18px;
      padding: 16px 16px 14px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.6);
      text-align: center;
      border: 3px solid #ffca28;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 800;
      color: #f57f17;
      margin-bottom: 6px;
    }

    .modal-text {
      font-size: 13px;
      color: #444;
      margin-bottom: 10px;
      line-height: 1.35;
    }

    .modal-text strong {
      color: #4a148c;
    }

    .modal-btn {
      border: none;
      border-radius: 999px;
      padding: 9px 18px;
      font-size: 14px;
      font-weight: 600;
      background: linear-gradient(135deg, #7e57c2, #5e35b1);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 6px 14px rgba(94,53,177,0.6);
    }

    @media (max-width: 480px) {
      .container {
        border-radius: 0;
        max-width: 100%;
        min-height: 100vh;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Femud Kazƒ± Kazan</h1>
    <div class="subtitle">
      ƒ∞smini ve Instagram adresini yaz, kartƒ± kazƒ±, Femud C√ºzdanƒ±na TL kazan!
    </div>

    <input id="nameInput" class="field" type="text" placeholder="Katƒ±lƒ±mcƒ± adƒ± (zorunlu)" />
    <input id="igInput" class="field" type="text" placeholder="Instagram adresi (@kullanici) (zorunlu)" />

    <div class="wallet-box">
      Femud C√ºzdan: <span id="walletAmount">0</span> TL
    </div>

    <div class="card-wrapper">
      <div class="card-glow"></div>
      <div class="scratch-card">
        <div class="scratch-header">Femud Premium</div>
        <div class="scratch-sub">Kazƒ± Kazan Kartƒ±</div>
        <div class="scratch-inner">
          <div id="scratchResultText" class="scratch-result-text">
            Kazanacaƒüƒ±nƒ±z tutar i√ßin kartƒ± kazƒ±yƒ±n!
          </div>
          <div id="scratchCover" class="scratch-cover">
            KAZIMAK ƒ∞√áƒ∞N TIKLA
          </div>
        </div>
      </div>
    </div>

    <button id="playBtn" class="btn-play">KARTI KAZI</button>

    <div id="result"></div>
  </div>

  <!-- 30 TL b√ºy√ºk √∂d√ºl bildirimi -->
  <div id="limitModal" class="modal-backdrop">
    <div class="modal-box">
      <div class="modal-title">B√úY√úK √ñD√úLE ULA≈ûTINIZ!</div>
      <div class="modal-text">
        Femud C√ºzdan bakiyeniz <strong>30 TL</strong> oldu.<br><br>
        L√ºtfen <strong>30 TL indirimli</strong> alacaƒüƒ±nƒ±z Femud √ºr√ºn√ºn√º se√ßin ve
        sipari≈ü sƒ±rasƒ±nda bu indirimi kullanƒ±n.<br><br>
        <strong>Not:</strong> 30 TL'lik bu hakkƒ± <strong>24 saat i√ßinde kullanmazsanƒ±z</strong>
        bakiye otomatik olarak sƒ±fƒ±rlanacaktƒ±r.
      </div>
      <button id="limitModalBtn" class="modal-btn">Tamam, anladƒ±m</button>
    </div>
  </div>

  <script>
    // ‚öôÔ∏è Google Apps Script Web API adresin
    const API_URL = "https://script.google.com/macros/s/AKfycbyplhi6pahLt8N68gKHnNbBn4cYJhbqLUlM81UHqHYLNzZEUsaSXLE0n5dc91-dc66z/exec";

    // üü£ C√ºzdan i√ßin localStorage anahtarlarƒ±
    const WALLET_KEY_A = "femud_wallet";
    const WALLET_KEY_B = "femud_wallet_balance";
    const WALLET_30_TS_KEY = "femud_wallet_30_ts";

    // Kazƒ± Kazan g√ºnl√ºk sƒ±nƒ±r (24 saat)
    const ONE_DAY_MS = 24 * 60 * 60 * 1000;

    const nameInput   = document.getElementById("nameInput");
    const igInput     = document.getElementById("igInput");
    const walletSpan  = document.getElementById("walletAmount");
    const playBtn     = document.getElementById("playBtn");
    const resultEl    = document.getElementById("result");
    const scratchCover = document.getElementById("scratchCover");
    const scratchResultText = document.getElementById("scratchResultText");
    const limitModal  = document.getElementById("limitModal");
    const limitModalBtn = document.getElementById("limitModalBtn");

    // üîπ C√ºzdan okuma / yazma (hem eski hem yeni anahtarƒ± senkron tutalƒ±m)
    function getWallet() {
      const a = Number(localStorage.getItem(WALLET_KEY_A) || 0);
      const b = Number(localStorage.getItem(WALLET_KEY_B) || 0);
      return Math.max(a, b, 0);
    }

    function setWallet(value) {
      const v = Math.max(0, Number(value) || 0);
      localStorage.setItem(WALLET_KEY_A, v.toString());
      localStorage.setItem(WALLET_KEY_B, v.toString());
      walletSpan.textContent = v.toString();
    }

    // ‚è± 30 TL √∂d√ºl√ºn√ºn s√ºresini kontrol et
    function checkWalletExpiry() {
      const current = getWallet();
      const ts = localStorage.getItem(WALLET_30_TS_KEY);

      // 30 TL deƒüilse s√ºreyi resetleyelim
      if (current < 30) {
        if (ts) {
          localStorage.removeItem(WALLET_30_TS_KEY);
        }
        return;
      }

      if (!ts) {
        // 30 TL'ye yeni ula≈ümƒ±≈ü olabilir, ama timestamp yoksa bir ≈üey yapma (birazdan set edebiliriz)
        return;
      }

      const diff = Date.now() - Number(ts);
      if (diff >= ONE_DAY_MS) {
        // 24 saat ge√ßmi≈ü, bakiyeyi sƒ±fƒ±rla
        setWallet(0);
        localStorage.removeItem(WALLET_30_TS_KEY);
        alert("30 TL b√ºy√ºk √∂d√ºl s√ºreniz dolduƒüu i√ßin Femud C√ºzdan bakiyeniz sƒ±fƒ±rlandƒ±.");
      }
    }

    // üéâ Konfeti
    function launchConfetti() {
      const colors = ["#ff5252", "#ffeb3b", "#69f0ae", "#40c4ff", "#ff80ab", "#b39ddb"];
      for (let i = 0; i < 80; i++) {
        const conf = document.createElement("div");
        conf.className = "confetti";
        const color = colors[Math.floor(Math.random() * colors.length)];
        conf.style.backgroundColor = color;
        const left = Math.random() * 100;
        const dx   = (Math.random() - 0.5) * 200 + "px";
        const delay = Math.random() * 0.3;

        conf.style.left = left + "vw";
        conf.style.setProperty("--dx", dx);
        conf.style.animationDelay = delay + "s";

        document.body.appendChild(conf);
        setTimeout(() => conf.remove(), 3500);
      }
    }

    // üéÅ Kazƒ± Kazan √∂d√ºlleri
    const scratchPrizes = [
      { text: "Tebrikler! 1 TL Femud C√ºzdan kazandƒ±nƒ±z.", reward: 1 },
      { text: "Harika! 2 TL Femud C√ºzdan kazandƒ±nƒ±z.", reward: 2 },
      { text: "≈ûanslƒ± g√ºn√ºn√ºzdesiniz! 3 TL Femud C√ºzdan kazandƒ±nƒ±z.", reward: 3 },
      { text: "S√ºper! 5 TL Femud C√ºzdan kazandƒ±nƒ±z.", reward: 5 },
      { text: "Bu sefer olmadƒ±, 0 TL. Bir dahaki sefere ≈üansƒ±nƒ±z a√ßƒ±k olsun!", reward: 0 }
    ];

    // Instagram bazlƒ± 24 saat kontrol
    function canPlayScratch(igClean) {
      const key = "femud_scratch_" + igClean.toLowerCase();
      const last = localStorage.getItem(key);
      if (!last) return true;
      const diff = Date.now() - Number(last);
      return diff >= ONE_DAY_MS;
    }

    function markScratchPlayed(igClean) {
      const key = "femud_scratch_" + igClean.toLowerCase();
      localStorage.setItem(key, Date.now().toString());
    }

    // Google Sheet'e g√∂nder
    function sendToSheet(name, ig, prizeText, reward, newBalance) {
      try {
        fetch(API_URL, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            source: "scratch",        // Oyun adƒ±
            name: name,
            ig: ig,
            prize: prizeText,
            reward: reward,           // Bu oyunda kazanƒ±lan TL
            walletBalance: newBalance // O andaki toplam c√ºzdan
          })
        }).catch(() => {});
      } catch (err) {
        console.log("Kayƒ±t g√∂nderilemedi:", err);
      }
    }

    // Sayfa y√ºklenince
    document.addEventListener("DOMContentLoaded", () => {
      // C√ºzdan ve s√ºre kontrol√º
      checkWalletExpiry();
      setWallet(getWallet());

      // Eƒüer 30 TL ise bildirimi g√∂ster
      if (getWallet() >= 30) {
        limitModal.classList.add("show");
      }
    });

    // 30 TL bildirimi kapatma
    limitModalBtn.addEventListener("click", () => {
      limitModal.classList.remove("show");
    });

    // Kart √ºzerindeki gri kazƒ±ma alanƒ±na tƒ±klama
    scratchCover.addEventListener("click", () => {
      // Butonla birlikte √ßalƒ±≈üsƒ±n; karta tƒ±klayƒ±nca da aynƒ± aksiyonu tetikleyelim
      playBtn.click();
    });

    // Asƒ±l oyun butonu
    playBtn.addEventListener("click", () => {
      const name = nameInput.value.trim();
      let ig = igInput.value.trim();

      if (!name || !ig) {
        alert("L√ºtfen katƒ±lƒ±mcƒ± adƒ± ve Instagram adresini doldurun.");
        return;
      }

      if (!ig.startsWith("@")) {
        ig = "@" + ig;
      }
      const igClean = ig.replace(/^@/, "").trim();

      // 24 saatlik Kazƒ± Kazan kƒ±sƒ±tƒ±
      if (!canPlayScratch(igClean)) {
        alert("Bu Instagram hesabƒ± son 24 saat i√ßinde Femud Kazƒ± Kazan oynadƒ±. L√ºtfen 24 saat sonra tekrar deneyin.");
        return;
      }

      // C√ºzdan limiti kontrol√º
      let currentWallet = getWallet();
      if (currentWallet >= 30) {
        // Zaten limitte ise tekrar TL vermeyelim
        limitModal.classList.add("show");
        resultEl.innerHTML = `
          Femud C√ºzdan bakiyeniz zaten <strong>30 TL</strong>. 
          <span class="note">L√ºtfen 30 TL indirimli √ºr√ºn√ºn√ºz√º se√ßip kullanƒ±n.</span>
        `;
        return;
      }

      // Rastgele √∂d√ºl se√ß
      const prize = scratchPrizes[Math.floor(Math.random() * scratchPrizes.length)];
      const reward = Number(prize.reward || 0);

      // Yeni c√ºzdan bakiyesi (30 TL √ºst√ºne √ßƒ±kmasƒ±n)
      let newWallet = currentWallet + reward;
      if (newWallet > 30) newWallet = 30;

      // Ekranda sonu√ß
      scratchResultText.textContent = prize.text;
      scratchCover.classList.add("hidden");

      resultEl.innerHTML = `
        Kazandƒ±ƒüƒ±nƒ±z: <strong>${prize.text}</strong><br>
        <span class="note">
          L√ºtfen ekran g√∂r√ºnt√ºs√º alarak Instagram'da
          <strong>@Femud_tr</strong> hesabƒ±na DM g√∂nderip kazandƒ±ƒüƒ±nƒ±z hakkƒ± bildiriniz.
          (Instagram adresiniz: <strong>@${igClean}</strong>)
        </span>
      `;

      // C√ºzdanƒ± g√ºncelle
      setWallet(newWallet);

      // 30 TL'ye ula≈ümƒ±≈üsa zaman damgasƒ± bƒ±rak
      if (newWallet >= 30 && currentWallet < 30) {
        localStorage.setItem(WALLET_30_TS_KEY, Date.now().toString());
        // Bildirimi a√ß
        setTimeout(() => {
          limitModal.classList.add("show");
        }, 600);
      }

      // Konfeti
      if (reward > 0) {
        launchConfetti();
      }

      // Google Sheet'e kaydet
      sendToSheet(name, igClean, prize.text, reward, newWallet);

      // 24 saatlik Kazƒ± Kazan kilidi
      markScratchPlayed(igClean);

      // Butonu devre dƒ±≈üƒ± bƒ±rak (g√ºnde 1 kez)
      playBtn.disabled = true;
    });
  </script>
</body>
</html>